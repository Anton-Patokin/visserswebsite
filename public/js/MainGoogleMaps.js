myApp.controller("GoogleMapsConroller",["$scope","$http",function(e,t){function n(t,n){var a={latitude:t.lat,longitude:t.lng,info:{id:t.id,titel:t.titel.substring(0,40),text:t.text.substring(0,100),type:t.type,image:"uploads/thumbnail/"+t.image}};a.id=t.id,"plaats"==n&&e.plaatsMarkers.push(a),"trainer"==n&&e.trainerMarkers.push(a),"wedstrijd"==n&&e.wedsrijdMarkers.push(a)}function a(){e.plaatsMarkers=[],e.trainerMarkers=[],e.wedsrijdMarkers=[]}function r(t){console.log(t),e.map.center.latitude=t.lat(),e.map.center.longitude=t.lng(),e.map.zoom=15}function o(n){var a,r=new c,o="",l="",u=new Date,h="",d="",g="",f="";e.calender={titel:"",prev:"",next:"",offset:"",html:""},o=n||u.getFullYear()+"-"+(Number(u.getMonth())+1),!1===(l=new Date(o))&&(l=s()),h=i(l.getMonth())+"-"+l.getFullYear(),e.calender.titel=h,d=l.getFullYear()+"-"+l.getMonth(),0==l.getMonth()&&(d=l.getFullYear()-1+"-12"),e.calender.prev=d,g=l.getFullYear()+"-"+(l.getMonth()+2),l.getMonth()>=11&&(g=l.getFullYear()+1+"-1"),e.calender.next=g,f=new Date(l.getFullYear(),l.getMonth()+1,0).getDate();var p=l.getFullYear(),m=l.getMonth()+1,M=0===l.getDay()?0:l.getDay();M=Number(M);var k=(a=new Date).getMonth()+1;a=a.getDate();for(var v=[],y=[],w=[1,2,12,13,14,15,16,26,27,28,29,30],D=[11,17,18,23,24,25],O=[4,5,6,7,8,19],T=[3,9,10,20,21,22],E=0;E<M;E++)v.push({day:"",today:!1,activity:""});for(E=1;E<=f;E++){var b="",j=E;a==E&&k==m&&(b="today");var F=new Date(l.getFullYear(),l.getMonth(),l.getDate()+(E-1)),R=r.NowMoonDay(F),Y="";-1!=w.indexOf(R)&&(Y="fish-bad"),-1!=D.indexOf(R)&&(Y="fish-meddium"),-1!=O.indexOf(R)&&(Y="fish-veryGood"),-1!=T.indexOf(R)&&(Y="fish-good"),v.push({day:j,today:b,activity:"",fishActivity:Y}),M%7!=6&&j!=f||(y.push(v),v=[]),M++}e.calender.html=y,console.log(e.calender.html),t({method:"GET",url:ROUTEFRONT+"/api/get/wedstrijden/"+p+"/"+m}).success(function(e){var t=[];angular.forEach(y,function(n,a){angular.forEach(n,function(n,r){t=[],angular.forEach(e,function(a,r){var o=new Date(a.datum).getDate();n.day==o&&(t.push(a),e.splice(r,1))}),y[a][r].activity=t})})}).error(function(){console.log("iets fout met ophalen van wedstrijden")})}function i(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e].substring(0,3)}function s(){return Math.floor((new Date).getTime()/1e3)}e.plaatsMarkers=[],e.trainerMarkers=[],e.wedsrijdMarkers=[],e.zoekenOpGoogleMapsnaarGidsen=function(e){t({method:"POST",url:ROUTEFRONT+"/api/zoeken/googleMaps/gids",data:{input:e}}).success(function(e){a(),angular.forEach(e,function(e,t){angular.forEach(e,function(e,a){n(e,t)})})}).error(function(e,t,n,a){console.log("error bij het zoeken")})},e.zoekenOpGoogleMapsnaarVisPlatsen=function(e){t({method:"POST",url:ROUTEFRONT+"/api/zoeken/googleMaps/visPlatsen",data:{input:e}}).success(function(e){a(),angular.forEach(e,function(e,t){angular.forEach(e,function(e,a){n(e,t)})})}).error(function(e,t,n,a){console.log("error bij het zoeken")})},e.zoekenOpGoogleMaps=function(e){t({method:"POST",url:ROUTEFRONT+"/api/zoeken/googleMaps",data:{input:e}}).success(function(e){a(),angular.forEach(e,function(e,t){angular.forEach(e,function(e,a){n(e,t)})})}).error(function(e,t,n,a){console.log("error bij het zoeken")})};var l=0;e.initVisPlaatsmarkers=function(){t({method:"GET",url:ROUTEFRONT+"/api/get/markers/visPlaats"}).success(function(e){angular.forEach(e,function(e,t){n(e,"plaats")})}).error(function(){++l<5&&e.initVisPlaatsmarkers(),console.log("iets verkeerd met api call bij visplaatsen aanvraag")})},e.initTrainersmarkers=function(){t({method:"GET",url:ROUTEFRONT+"/api/get/markers/trainers"}).success(function(e){angular.forEach(e,function(e,t){n(e,"trainer")})}).error(function(){++l<5&&e.initTrainersmarkers(),console.log("iets verkeerd met api call bij trainer aanvraag")})},e.initWedstrijdmarkers=function(){t({method:"GET",url:ROUTEFRONT+"/api/get/markers/wedstrijden"}).success(function(e){angular.forEach(e,function(e,t){n(e,"wedstrijd")})}).error(function(){++l<5&&e.initWedstrijdmarkers(),console.log("iets verkeerd met api call bij visplaatsen aanvraag")})},e.options={autocomplete:!0,types:["(cities)"],componentRestrictions:{country:"be"}},e.map={center:{latitude:center.latitude,longitude:center.longitude},searchbox:{template:"searchbox.tpl.html",events:{place_changed:function(e){place=e.getPlace(),r(place.geometry.location)}},options:{autocomplete:!0,types:["(cities)"],componentRestrictions:{country:["be","nl"]}}},options:{scrollwheel:!1,minZoom:7,maxZoom:17},zoom:8,markers:{wedstrijd:{events:{click:function(t){console.log("marker kicked",t.model.title),e.markerTitel=t.model.title,e.map.markers.wedstrijd.wedstrijdWindowShow=!0,e.$apply()}},wedstrijdWindowShow:!1}}},e.changeCalenderMonth=function(e){o(e)},e.toon_wedstrijd_list=function(e){e.length&&(a(),angular.forEach(e,function(e,t){n(e,"wedstrijd"),console.log(e)}))};var c=new Object;c=function(){this.Day=0,this.Month=0,this.Year=0,this.GetMoonDay=function(e,t,n){this.Day=e,this.Month=t,this.Year=n,t<=2&&(t+=12,n-=1);var a=Math.floor(n/100),r=Math.floor(a/3)+Math.floor(a/4)+6-a,o=n/19,i=(209*(o-parseInt(o))+t+e+r)/30;return Math.round(30*(i-parseInt(i))+1)},this.SetNowDate=function(e){if(e)t=e;else var t=new Date;this.Day=t.getDate(),this.Month=t.getMonth()+1,this.Year=t.getYear(),this.Year<1e3&&(this.Year+=1900)},this.NowMoonDay=function(e){return this.SetNowDate(e),this.GetMoonDay(this.Day,this.Month,this.Year)}},o()}]);